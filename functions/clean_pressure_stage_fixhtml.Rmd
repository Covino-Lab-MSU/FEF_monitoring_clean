---
title: "HOBO water level logger data cleaning - Fool Creek "
author: "Adapted for FEF by LKremer"
date: "`r format(Sys.Date())`"
output:
  html_document:
    theme: journal
    highlight: breezedark
    code_folding: hide
    toc: true
    toc_float: true
    toc_depth: 3
---

This script is used to clean water level data from HOBO water level loggers (U20L-04)
designed for surface water level measurements.
Cleaning and QA/QC steps include: 

1) removing bad data
2) adjusting data for shifts in logger position
3) converting stage to water depth
4) checking results against manual measurements.

Inputs are water level logger raw data (periodically downloaded .csvs) and a manual measurement spreadsheet specific to the site being reviewed

Setup
Package and function import from .R script

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(message=F, warning=F, error=F, 
                      comment=NA, cache=T, R.options=list(width=220), 
                      fig.align='center', out.width='75%', fig.asp=.75)

pkgTest <- function(x)
{
  if (x %in% rownames(installed.packages()) == FALSE) {
    install.packages(x, dependencies= TRUE)
  }
  library(x, character.only = TRUE)
}

#if(!require(devtools)) install.packages("devtools")
#devtools::install_github("kassambara/gg1pubr")

# Make a vector of the packages you need
neededPackages <- c('tidyverse', 'lubridate', 'xts', 'dygraphs', 'ggrepel','knitr', 'plotly', "ggpubr") #tools for plot titles 

# For every package in the vector, apply your pkgTest function
for (package in neededPackages){pkgTest(package)}

source('./functions/ws_transect_pressure_stageFunctions.R') #load helper functions

```

Additional functions
Functions that open and concatenate formatted data files

```{r functions22, include=FALSE}
interfiles <- 'formatted_data/stage_pressure'
year <- 2021
watershed<- 'fool'
site <- 'fc1'

file_path <- paste(getwd(), interfiles, year, watershed, site, sep='/')
path_list <- paste(file_path, list.files(file_path), sep= '/')

newpath_list <- lapply(path_list, function(x) {
  gsub("FC1", "fc1", x) 
})

newpath_list <- lapply(path_list, function(x) {
  if  ('RW1' %in% x)
    gsub("RW1", "rw1", x)
  }
  elseif
  {
  gsub("RW2", "rw2", x)
  gsub("RW3", "rw3", x)
  gsub("RW4", "rw4", x)
  gsub("LW1", "lw1", x)

   })
   
newpath_list
```


```{r functions22, include=FALSE}
# A universal function to open all water level logger data for a 'site' to a list of dataframes
opn_as_dflist <- function(interfiles, year, watershed, site) {
   file_path <- paste(getwd(), interfiles, year, watershed, site, sep='/')
   path_list <- paste(file_path, list.files(file_path), sep= '/')
   data <- lapply(path_list, function(x) {
      dat <- read.table(x, skip = 1, header = TRUE, sep = ",", row.names = NULL, as.is = TRUE)
      dat <- dat[, 2:ncol(dat)]
      colnames(dat) <- c('datetime', 'pressure_kPa', 'temperature_C')
      # for each item in path list, grab the cap_rod number
      dat$logger_no <- as.factor(unlist(strsplit(x, "_"))[8])
      dat$trans_loc <- as.factor(unlist(strsplit(x, "_"))[7])
      return(dat)
   })
}

concat_2022 <- function(data) {
  combined.data <- do.call(rbind, data)
  combined.data <- combined.data %>%
    mutate(datetime = lubridate::mdy_hm(datetime)) %>%
    arrange(datetime) %>%
    drop_na() %>%
    dplyr::distinct() %>%
    rowid_to_column(var='ID')
   return(combined.data)
}

```


## 2022 {.tabset .tabset-fade}

### Fool1 {.tabset .tabset-fade}

```{r importfc1_20, include=FALSE}
interfiles <- 'formatted_data/stage_pressure'
year <- 2022
watershed<- 'fool'
site <- 'fc1'

press_raw <- concat_2022(opn_as_dflist(interfiles, year, watershed, site))
```

Quick raw plot of point data

```{r plot1fc1_22, fig.align = "center", fig.cap = 'Figure 1.2021.FC1.all: Raw data for all HOBO water level loggers in the Fool 1 transect - 2021.', echo=FALSE}
#quick plot of stage
#stage_raw[stage_raw$trans_loc == 'atms',]

ggplot(press_raw, aes(datetime, pressure_kPa, color = trans_loc))+
  geom_line() + 
  ggtitle(paste(watershed, year, sep = ' '))

```

Subset based on logger location within the transect

```{r dfsplit_fc1_22}
press_raw_list <- split(press_raw, press_raw$trans_loc)

# Write out single data frames
for (i in seq(press_raw_list))
  assign(paste0('press_raw_', press_raw_list[[i]]$trans_loc[i]), press_raw_list[[i]])
```

#### Atmospheric {.tabset .tabset-fade .tabset-pills}

##### Check timesteps
Check if collection interval is consistent in dataset. Then identify missing timesteps.

```{r checktimefc1_atms22, results = 'asis'}
#check if collection interval is consistent in dataset. Function as written only handles one interval but can be modified if interval was changed. 

ts_interval<- press_raw_atms$datetime[2] - press_raw_atms$datetime[1]

##round datetime to nearest whole interval
press_raw_atms <- press_raw_atms%>%
  mutate(datetime = round_date(datetime, as.period(ts_interval)))

#create full timeseries 
full_ts <- tibble(datetime=seq.POSIXt(press_raw_atms$datetime[1], press_raw_atms$datetime[length(press_raw_atms$datetime)], by=ts_interval))
press_raw_atms <- full_join(full_ts,press_raw_atms, by='datetime')

#identify missing timesteps:
miss_ts <- filter(press_raw_atms, is.na(pressure_kPa)) %>%
  pull(datetime)
```

```{r checktime2fc1_atms22, echo=FALSE, results = 'asis'}
cat(paste0(
  "- `", 'The number of missing timesteps is ', length(miss_ts), "`", sep = "\n"))

```

##### Check temperature

Keep in mind that the the factory calibrated ranges are:
0° to 40°C (32° to 104°F)
 
```{r chktempfc1_atms22, fig.align = "center", fig.cap = "Figure1.2021.FC1.atms: Air temperature data captured by the HOBO water level logger monitoring atmospheric pressure in Fool 1 - 2021.", echo=FALSE}

#check temp data
DyTemp(df = press_raw_atms, airtemp = 'n') #check function if have logger_temp, default is 'y'

# Even with atmospheric HOBO, it appears that the HOBO logger does not record temps below 0C. 
```

##### Clean data
###### 1) Plot raw data with flag if raw level changes by more than 0.02.

```{r plantflagsfc1_atms22, fig.align = "center", fig.cap = "Figure2.2021.FC1.atms:: Raw stage data from Fool 1 2021 with 'flags' where average stage changes by more than 20% in a single timestep", echo=FALSE}

#Raw stage plot
DyRawPress(df=press_raw_atms,threshold = 0.2, flag='TRUE')
```

###### 2) Manually identify points to be removed or corrected using the flagged plot

```{r badidfc1_atms22}

bad_id_fc1_atms22 <-  c(0)

vert_correction_fc1_atms22<- data.frame(ID = c(0:1), offset=c(0))%>%
  mutate(cumOffset = cumsum(offset))
```


```{r badid2fc1_atms22, include=FALSE}  
bad_id <- bad_id_fc1_atms22
vert_correction <- vert_correction_fc1_atms22
```

###### 3) Vertical adjustments

```{r vertcorrectfc1_atms22}

#function to make vertical correction and interpolate between missing values 
press_adj<- AdjPress(df=press_raw_atms, maxgap=8)%>%
    mutate(watershed = watershed)%>%
    mutate(site = site)%>%
    filter(ID > 3) %>% # beginning of data
    mutate(level_flag = ifelse(pressure_kPa < -65, 'Below Logger',
    ifelse(pressure_kPa > 75, 'Over Logger', 'In Range')))

#stageAdj<- AdjStage(maxgap=30)

```

##### Plot adjusted stage

```{r plot4fc1_22, fig.align = "center", fig.cap = "Figure3.2021.FC1.atms: Pressure data from Fool 1 atmospheric data. No adjustments to the raw data are needed", echo=FALSE}

dyPressAdj(df=press_adj)

```

##### Export cleaned data

```{r savefc1atms_22}
#stage_final <- stage_adj %>%
press_final <- press_adj %>%
      drop_na() %>%
      mutate(date = lubridate::date(datetime)) %>%
      mutate(time = format(datetime, format = "%H:%M")) %>%
        #dplyr::select(watershed, site, date, time, wtr_depth, level_flag) 
      dplyr::select(watershed, site, date, time, adj_press, level_flag) 
    
loc_site<- paste(watershed,site, sep='_') 

interfiles <- 'clean_data/stage_pressure'
file_path <- paste(getwd(), interfiles,year,watershed,site, sep='/')
#saveRDS(stage_final, file=paste0('data/cln/wtr_lvl_',loc_site,'.csv'))
write_csv(press_final, file=paste0(file_path, '/',site, 'atms_clean.csv'))

```

#### Stream {.tabset .tabset-fade .tabset-pills}

```{r formatstream_fc1}
mrg_press_adj <- as.data.frame(press_adj[,c('datetime','adj_press')])
  
stage_stream <- merge(press_raw_stream, mrg_press_adj, by = 'datetime') %>%
  mutate(adj_h2opressure = pressure_kPa - adj_press) %>%
  mutate(hobo_wtr_depth_cm = ((100*(adj_h2opressure*7.0)/145)) + 1.6) # kPa range 0-145, range at 10,000ft 0 to 7m plus 1.6cm for logger sensor height

```

##### Check timesteps
Check if collection interval is consistent in dataset. Then identify missing timesteps.

```{r checktimefc1_stream22, echo=FALSE, results = 'asis'}
#check if collection interval is consistent in dataset. Function as written only handles one interval but can be modified if interval was changed. 

ts_interval<- stage_stream$datetime[2] - stage_stream$datetime[1]

##round datetime to nearest whole interval
stage_stream <- stage_stream%>%
  mutate(datetime = round_date(datetime, as.period(ts_interval)))

#create full timeseries 
full_ts <- tibble(datetime=seq.POSIXt(stage_stream$datetime[1], stage_stream$datetime[length(stage_stream$datetime)], by=ts_interval))
stage_stream <- full_join(full_ts, stage_stream, by='datetime')

#identify missing timesteps:
miss_ts <- filter(stage_stream, is.na(pressure_kPa)) %>%
  pull(datetime)
```


```{r checktime2fc1_stream22, echo=FALSE, results = 'asis'}
cat(paste0(
  "- `", 'The number of missing timesteps is ', length(miss_ts), "`", sep = "\n"))

```

##### Check temperature

Keep in mind that the the factory calibrated ranges are:
0° to 40°C (32° to 104°F)
 
```{r chktempfc1_stream22, fig.align = "center", fig.cap = "Figure1.2021.FC1.stream: Air temperature data captured by the HOBO water level logger monitoring stream pressure in Fool 1 - 2021.", echo=FALSE}

#check temp data
DyTemp(df = stage_stream, airtemp = 'n') #check function if have logger_temp, default is 'y'

```

##### Clean data
###### 1) Plot raw data with flag if raw level changes by more than 0.02.

```{r plantflagsfc1_stream22a, fig.align = "center", fig.cap = "Figure2.2021.FC1.stream: Raw pressure data from Fool 1 stream 2021 with 'flags' where average pressure changes by more than 20% in a single timestep", echo=FALSE}

#Raw stage plot
DyRawPress(df=stage_stream,threshold = 0.2, flag='TRUE')
```

Clean raw stage

Plot raw water depth data with flag if raw level changes by more than 2%.

```{r plantflagsfc1_stream22b, fig.align = "center", fig.cap = "Figure2.2021.FC1.stream: Raw stage data from Fool 1 stream 2021 with 'flags' where average stage changes by more than 20% in a single timestep", echo=FALSE}

#Raw stage plot
DyRawStage(df=stage_stream, threshold = 0.2, flag='TRUE')
```

###### 2) Manually identify points to be removed or corrected using the flagged plot
```{r badidfc1_stream22}

bad_id_fc1_stream22 <-  c(0)

vert_correction_fc1_stream22<- data.frame(ID = c(0:1), offset=c(0))%>%
  mutate(cumOffset = cumsum(offset))
```


```{r badid2fc1_stream22, include=FALSE}  
bad_id <- bad_id_fc1_stream22
vert_correction <- vert_correction_fc1_stream22
```

###### 3) Vertical adjustments
```{r vertcorrectfc1_stream22}

#function to make vertical correction and interpolate between missing values 
stage_adj<- AdjStage(df=stage_stream, maxgap=8) %>%
    mutate(watershed = watershed) %>%
    mutate(site = site) %>%
    filter(ID > 3) %>% # beginning of data
    mutate(level_flag = ifelse(pressure_kPa < 0, 'Below Logger',
    ifelse(pressure_kPa > 145, 'Over Logger', 'In Range')))

#stageAdj<- AdjStage(maxgap=30)

```

Plot adjusted stage
```{r plot4fc1_stream_22, fig.align = "center", fig.cap = "Figure3.2021.FC1.stream: Pressure data from Fool 1 stream after the first round of adjustments, which include eliminating points where HOBO was out of the stream for periodic downloading and eliminating points collected after HOBO was removed from the stream. Both raw and adjusted values are shown", echo=FALSE}

dyStageAdj(df=stage_adj)

```

Plot adjusted values only:
```{r plot5fc1_stream_22, fig.align = "center", fig.cap = "Figure 3.1.5: Same as 3.1.4 but limited to adjusted values only.", echo=FALSE}
dyStageAdjonly<- function(df, max=20){
      tsStageAdj<- xts(dplyr::select(df, datetime, adj_stage, ID), order.by=df$datetime)
      dygraph(tsStageAdj, main = site) %>% 
            dyAxis('y',label='kPa',valueRange = c(0, max))%>%
            dyAxis('y2',label='ID',independentTicks=T)%>%
            dySeries('ID',axis='y2')%>%
            dyRangeSelector() %>%
            #dyHighlight(highlightCircleSize = 4, 
            #        highlightSeriesBackgroundAlpha = 0.2,
            #       hideOnMouseOut = TRUE)%>%
            dyOptions(drawPoints = FALSE, pointSize = 2)%>%
            dyLegend(show = "always")
}

dyStageAdjonly(df=stage_adj)
```

###### 4) Check manual measurements 

Add and plot stream measurements performed from caprod post

```{r importmanualfc1_stream_22}
# load manual measurements
interfiles <- 'formatted_data/manual_measurements/2022/caprod_measurements.csv'
file_path <- paste(getwd(),interfiles, sep='/')

manMeas <- read.table(file_path, skip=0, header=TRUE, sep=",", row.names = NULL, as.is = TRUE)

manMeas<- read.csv(file_path) %>%
      #timezone set to MST, change if loggers used MDT/MST
      mutate(datetime = round_date(mdy_hm(datetime, tz='America/Phoenix'),'30 minutes')) %>% 
      mutate(water_depth = to_bed_cm - to_water_surface_cm) %>%
      filter(., site == 'fc1')

cols <- c('watershed', 'site')
manMeas[cols] <- lapply(manMeas[cols], factor) 
```


```{r depthoffsetfc1_stream_22}
#choose a static depth to bed value. Here we are using a mean of manual bed measurements from the top of the caprod post
stat_to_bed <- manMeas%>%
  summarize(mean_dep_to_bed = mean(to_bed_cm,na.rm=T))%>%
  pull(mean_dep_to_bed)

manMeas_fil <- manMeas %>%
      dplyr::rename(., wtr_depth_not_static = water_depth) %>%
      mutate(man_wtr_dep_static = stat_to_bed - to_water_surface_cm)
### 10 to convert mm to cm

depth_offset <- manMeas_fil %>%
  slice_max(datetime) %>%
  left_join(stage_adj %>%
              dplyr::select(datetime, adj_stage)) %>%
  mutate(depth_offset = man_wtr_dep_static - adj_stage)%>%
  pull(depth_offset)
```

Manual adjustments: 
```{r plot6fc1_stream_22,, fig.align = "center", fig.cap = "Figure4.2021.FC1.stream: Adjusted pressure data from Fool 1 stream channel which includes a manual offset that adjusts all values in the dataframe."}
#start with 0 value, change if plots below suggest need for manual adjustment change value. 
manual_offset <- 0

stage_adj <- stage_adj%>%
  mutate(wtr_depth = adj_stage + depth_offset + manual_offset)

```

Compare cleaned water level to manual measurements
```{r plot7fc1_stream_22, fig.align = "center"}
#plot difference between measured water depth and manual depth measurement
stage_adj <- as.data.frame(stage_adj)
stageAdj.man<- dplyr::left_join(manMeas_fil, stage_adj, by = 'datetime') %>%
      mutate(diff = man_wtr_dep_static-wtr_depth)

ggplot(stageAdj.man, aes(datetime, diff))+
  geom_point(size=3)+
  theme_minimal()
```

##### Plot adjusted stage

```{r plot8fc1_stream_22, fig.align = "center", fig.cap = "Figure 2.1.7: Adjusted stage data with manual measurements (points)"}
#plot water level time series with manual measurements as points
stage_check_plot<- stage_adj%>%
  dplyr::left_join(.,manMeas_fil, by = 'datetime') %>%
  ggplot(aes(datetime,wtr_depth))+
    geom_line()+
    geom_point(aes(datetime, man_wtr_dep_static),size=3,col='red')

ggplotly(stage_check_plot)
```

##### Export cleaned data

```{r savefc1_stream_22}
stage_final <- stage_adj %>%
      drop_na() %>%
      mutate(date = lubridate::date(datetime)) %>%
      mutate(time = format(datetime, format = "%H:%M")) %>%
      dplyr::select(watershed, site, date, time, wtr_depth, level_flag) 
    
loc_site<- paste(watershed,site, sep='_') 

interfiles <- 'clean_data/stage_pressure'
file_path <- paste(getwd(), interfiles,year,watershed,site, sep='/')
#saveRDS(stage_final, file=paste0('data/cln/wtr_lvl_',loc_site,'.csv'))
write_csv(stage_final, file=paste0(file_path, '/',site, '_clean.csv'))

```

#### LW1 {.tabset .tabset-fade .tabset-pills}

```{r formatlw1_fc1_22}
mrg_press_adj <- as.data.frame(press_adj[,c('datetime','adj_press')])
  
stage_well <- merge(press_raw_lw1, mrg_press_adj, by = 'datetime') %>%
  mutate(adj_h2opressure = pressure_kPa - adj_press) %>%
  mutate(hobo_wtr_depth_cm = ((100*(adj_h2opressure*7.0)/145)) + 1.6) # kPa range 0-145, range at 10,000ft 0 to 7m plus 1.6cm for logger sensor height

```

##### Check timesteps
Check if collection interval is consistent in dataset. Then identify missing timesteps.

```{r checktimefc1_lw1_22, echo=FALSE, results = 'asis'}
#check if collection interval is consistent in dataset. Function as written only handles one interval but can be modified if interval was changed. 

ts_interval<- stage_well$datetime[2] - stage_well$datetime[1]

##round datetime to nearest whole interval
stage_well <- stage_well%>%
  mutate(datetime = round_date(datetime, as.period(ts_interval)))

#create full timeseries 
full_ts <- tibble(datetime=seq.POSIXt(stage_well$datetime[1], stage_well$datetime[length(stage_well$datetime)], by=ts_interval))
stage_well <- full_join(full_ts, stage_well, by='datetime')

#identify missing timesteps:
miss_ts <- filter(stage_well, is.na(pressure_kPa)) %>%
  pull(datetime)
```


```{r checktime2fc1_lw1_22, echo=FALSE, results = 'asis'}
cat(paste0(
  "- `", 'The number of missing timesteps is ', length(miss_ts), "`", sep = "\n"))

```

##### Check temperature

Keep in mind that the the factory calibrated ranges are:
0° to 40°C (32° to 104°F)

```{r chktempfc1_lw1_22, fig.align = "center", fig.cap = "Figure1.2202.FC1.lw1: Air temperature data captured by the HOBO water level logger monitoring stream pressure in Fool 1 - 2021.", echo=FALSE}

#check temp data
DyTemp(df = stage_well, airtemp = 'n') #check function if have logger_temp, default is 'y'

#  lw1 (55442:55497, 64922:64937, 69922:69942, 80107:80137, 85607:85602, 90797:90822, 90522:90543)
```

##### Clean data
###### 1) Plot raw pressure data with flag if raw level changes by more than 20%.

```{r plantflagsfc1_lw1_22a, fig.align = "center", fig.cap = "Figure2.2202.FC1.lw1: Raw pressure data from Fool 1 stream 2021 with 'flags' where average pressure changes by more than 20% in a single timestep", echo=FALSE}

#Raw pressure plot
DyRawPress(df=stage_well,threshold = 0.05, flag='TRUE')
```

Plot raw water depth data with flag if raw level changes by more than 2%.

```{r plantflagsfc1_lw1_22b, fig.align = "center", fig.cap = "Figure2.2202.FC1.lw1: Raw stage data from Fool 1 stream 2021 with 'flags' where average stage changes by more than 20% in a single timestep", echo=FALSE}

#Raw stage plot
DyRawStage(df=stage_well, threshold = 0.2, flag='TRUE', max = 100)
```

###### 2) Manually identify points to be removed or corrected using the flagged plot

```{r badidfc1_lw1_22}

bad_id_fc1_well22 <-  c(55442:55497, 64917:64962, 69922:69942, 80107:80137, 85607:85642, 90672:90757, 90797:90822, 90522:90543, 95017:95061 )

vert_correction_fc1_well22<- data.frame(ID = c(0:1), offset=c(0))%>%
  mutate(cumOffset = cumsum(offset))
```


```{r badid2fc1_lw1_22, include=FALSE}  
bad_id <- bad_id_fc1_well22
vert_correction <- vert_correction_fc1_well22
```

###### 3) Vertical adjustments

```{r vertcorrectfc1_lw1_22}

#function to make vertical correction and interpolate between missing values 
stage_adj<- AdjStage(df=stage_well, maxgap=8) %>%
    mutate(watershed = watershed) %>%
    mutate(site = site) %>%
    filter(ID > 3) %>% # beginning of data
    mutate(level_flag = ifelse(pressure_kPa < 0, 'Below Logger',
    ifelse(pressure_kPa > 145, 'Over Logger', 'In Range')))

#stageAdj<- AdjStage(maxgap=30)

```

Plot adjusted stage

```{r plot4fc1_lw1_22, fig.align = "center", fig.cap = "Figure3.2202.FC1.lw1: Pressure data from Fool 1 stream after the first round of adjustments, which include eliminating points where HOBO was out of the stream for periodic downloading and eliminating points collected after HOBO was removed from the stream. Both raw and adjusted values are shown", echo=FALSE}

dyStageAdj(df=stage_adj, max = 80)

```

Plot adjusted values only:

```{r plot5fc1_lw1_22, fig.align = "center", fig.cap = "Figure 3.1.5: Same as 3.1.4 but limited to adjusted values only.", echo=FALSE}
dyStageAdjonly<- function(df, max=50){
      tsStageAdj<- xts(dplyr::select(df, datetime, adj_stage, ID), order.by=df$datetime)
      dygraph(tsStageAdj, main = site) %>% 
            dyAxis('y',label='cm',valueRange = c(30, max))%>%
            dyAxis('y2',label='ID',independentTicks=T)%>%
            dySeries('ID',axis='y2')%>%
            dyRangeSelector() %>%
            #dyHighlight(highlightCircleSize = 4, 
            #        highlightSeriesBackgroundAlpha = 0.2,
            #       hideOnMouseOut = TRUE)%>%
            dyOptions(drawPoints = FALSE, pointSize = 2)%>%
            dyLegend(show = "always")
}

dyStageAdjonly(df=stage_adj)
```

###### 4) Check manual measurements 

Stream measurements performed from caprod post

```{r importmanualfc1_lw1_22}
# load manual measurements
interfiles <- 'formatted_data/manual_measurements/2022/manual_wells_waterlevel_meas.csv'
file_path <- paste(getwd(),interfiles, sep='/')

manMeas <- read.table(file_path, skip=0, header=TRUE, sep=",", row.names = NULL, as.is = TRUE)

manMeas<- read.csv(file_path) %>%
      #timezone set to MST, change if loggers used MDT/MST
  mutate(datetime = round_date(mdy_hm(datetime, tz='America/Phoenix'),'30 minutes')) %>% 
  mutate(water_depth = dep_to_bed-dep_to_water) %>% 
  filter(., site == 'fc1' & position == 'lw1' )
  
cols <- c('watershed', 'site', 'position', 'tech')
manMeas[cols] <- lapply(manMeas[cols], factor) 
```


```{r depthoffsetfc1_lw1_22}
#choose a static depth to bed value. Here we are using a mean of manual bed measurements from the top of the caprod post
stat_to_bed <- manMeas%>%
  summarize(mean_dep_to_bed = mean(dep_to_bed,na.rm=T))%>%
  pull(mean_dep_to_bed)

manMeas_fil <- manMeas %>%
      dplyr::rename(., wtr_depth_not_static = water_depth) %>%
      mutate(man_wtr_dep_static = stat_to_bed - dep_to_water)
### 10 to convert mm to cm

depth_offset <- manMeas_fil %>%
  slice_min(datetime) %>%
  left_join(stage_adj %>%
              dplyr::select(datetime, adj_stage)) %>%
  mutate(depth_offset = man_wtr_dep_static - adj_stage)%>%
  pull(depth_offset)
```

Manual adjustments: 
```{r plot6fc1_lw1_22,, fig.align = "center", fig.cap = "Figure4.2202.FC1.lw1: Adjusted pressure data from Fool 1 stream channel which includes a manual offset that adjusts all values in the dataframe."}
#start with 0 value, change if plots below suggest need for manual adjustment change value. 
manual_offset <- 0

stage_adj <- stage_adj%>%
  mutate(wtr_depth = adj_stage + depth_offset + manual_offset)

```

Compare cleaned water level to manual measurements

```{r plot7fc1_lw1_22, fig.align = "center"}
#plot difference between measured water depth and manual depth measurement
stage_adj <- as.data.frame(stage_adj)
stageAdj.man<- dplyr::left_join(manMeas_fil, stage_adj, by = 'datetime') %>%
      mutate(diff = man_wtr_dep_static-wtr_depth)

ggplot(stageAdj.man, aes(datetime, diff))+
  geom_point(size=3)+
  theme_minimal()
```

##### Plot adjusted stage

```{r plot8fc1_lw1_22, fig.align = "center", fig.cap = "Figure 2.1.7: Adjusted stage data with manual measurements (points)"}
#plot water level time series with manual measurements as points
stage_check_plot<- stage_adj%>%
  dplyr::left_join(.,manMeas_fil, by = 'datetime') %>%
  ggplot(aes(datetime,wtr_depth))+
    geom_line()+
    geom_point(aes(datetime, man_wtr_dep_static),size=3,col='red')

ggplotly(stage_check_plot)
```

##### Export cleaned data

```{r savefc1_lw1_22}
stage_final <- stage_adj %>%
      drop_na() %>%
      mutate(date = lubridate::date(datetime)) %>%
      mutate(time = format(datetime, format = "%H:%M")) %>%
      dplyr::select(watershed, site, date, time, wtr_depth, level_flag) 
    
loc_site<- paste(watershed,site, sep='_') 

interfiles <- 'clean_data/stage_pressure'
file_path <- paste(getwd(), interfiles,year,watershed,site, sep='/')
#saveRDS(stage_final, file=paste0('data/cln/wtr_lvl_',loc_site,'.csv'))
write_csv(stage_final, file=paste0(file_path, '/',site, '_clean.csv'))

```

#### LW2 {.tabset .tabset-fade .tabset-pills}

```{r formatlw2_fc1_22}
mrg_press_adj <- as.data.frame(press_adj[,c('datetime','adj_press')])
  
stage_well <- merge(press_raw_lw2, mrg_press_adj, by = 'datetime') %>%
  mutate(adj_h2opressure = pressure_kPa - adj_press) %>%
  mutate(hobo_wtr_depth_cm = ((100*(adj_h2opressure*7.0)/145)) + 1.6) # kPa range 0-145, range at 10,000ft 0 to 7m plus 1.6cm for logger sensor height

```

##### Check timesteps
Check if collection interval is consistent in dataset. Then identify missing timesteps.

```{r checktimefc1_lw2_22, echo=FALSE, results = 'asis'}
#check if collection interval is consistent in dataset. Function as written only handles one interval but can be modified if interval was changed. 

ts_interval<- stage_well$datetime[2] - stage_well$datetime[1]

##round datetime to nearest whole interval
stage_well <- stage_well%>%
  mutate(datetime = round_date(datetime, as.period(ts_interval)))

#create full timeseries 
full_ts <- tibble(datetime=seq.POSIXt(stage_well$datetime[1], stage_well$datetime[length(stage_well$datetime)], by=ts_interval))
stage_well <- full_join(full_ts, stage_well, by='datetime')

#identify missing timesteps:
miss_ts <- filter(stage_well, is.na(pressure_kPa)) %>%
  pull(datetime)
```


```{r checktime2fc1_lw2_22, echo=FALSE, results = 'asis'}
cat(paste0(
  "- `", 'The number of missing timesteps is ', length(miss_ts), "`", sep = "\n"))

```

##### Check temperature
Keep in mind that the the factory calibrated ranges are:
0° to 40°C (32° to 104°F)

 
```{r chktempfc1_lw2_22, fig.align = "center", fig.cap = "Figure1.2202.FC1.lw2: Air temperature data captured by the HOBO water level logger monitoring stream pressure in Fool 1 - 2021.", echo=FALSE}

#check temp data
DyTemp(df = stage_well, airtemp = 'n') #check function if have logger_temp, default is 'y'

#  lw2 (64923:64968, 69923:69948, 80098:80148, 85613:85643, 90693:90718, 90798:90813, 95023:95074)
```

2) Plot raw pressure data with flag if raw level changes by more than 2%.
```{r plantflagsfc1_lw2_22a, fig.align = "center", fig.cap = "Figure2.2202.FC1.lw2: Raw pressure data from Fool 1 stream 2021 with 'flags' where average pressure changes by more than 20% in a single timestep", echo=FALSE}

#Raw pressure plot
DyRawPress(df=stage_well,threshold = 0.05, flag='TRUE')
```

##### Clean data

###### 1) Plot raw water depth data with flag if raw level changes by more than 2%.
```{r plantflagsfc1_lw2_22b, fig.align = "center", fig.cap = "Figure2.2202.FC1.lw2: Raw stage data from Fool 1 stream 2021 with 'flags' where average stage changes by more than 20% in a single timestep", echo=FALSE}

#Raw stage plot
DyRawStage(df=stage_well, threshold = 0.2, flag='TRUE', max = 100)
```


###### 2) Manually identify points to be removed or corrected using the flagged plot
```{r badidfc1_lw2_22}

bad_id_fc1_well22 <-  c(64923:64968, 69923:69993, 80098:80148, 85603:85728, 90678:90798, 90798:90813, 90843:90928, 95013:95164 )

vert_correction_fc1_well22<- data.frame(ID = c(0:1), offset=c(0))%>%
  mutate(cumOffset = cumsum(offset))
```


```{r badid2fc1_lw2_22, include=FALSE}  
bad_id <- bad_id_fc1_well22
vert_correction <- vert_correction_fc1_well22

#bad_id <- 0
```

###### 3) Vertical adjustments
```{r vertcorrectfc1_lw2_22}

#function to make vertical correction and interpolate between missing values 
stage_adj<- AdjStage(df=stage_well, maxgap=8) %>%
    mutate(watershed = watershed) %>%
    mutate(site = site) %>%
    filter(ID > 3) %>% # beginning of data
    mutate(level_flag = ifelse(pressure_kPa < 0, 'Below Logger',
    ifelse(pressure_kPa > 145, 'Over Logger', 'In Range')))

#stageAdj<- AdjStage(maxgap=30)

```

Plot adjusted stage
```{r plot4fc1_lw2_22, fig.align = "center", fig.cap = "Figure3.2202.FC1.lw2: Pressure data from Fool 1 stream after the first round of adjustments, which include eliminating points where HOBO was out of the stream for periodic downloading and eliminating points collected after HOBO was removed from the stream. Both raw and adjusted values are shown", echo=FALSE}

dyStageAdj(df=stage_adj, max = 80)

```

Plot adjusted values only:
```{r plot5fc1_lw2_22, fig.align = "center", fig.cap = "Figure 3.1.5: Same as 3.1.4 but limited to adjusted values only.", echo=FALSE}
dyStageAdjonly<- function(df, max=50){
      tsStageAdj<- xts(dplyr::select(df, datetime, adj_stage, ID), order.by=df$datetime)
      dygraph(tsStageAdj, main = site) %>% 
            dyAxis('y',label='cm',valueRange = c(0, max))%>%
            dyAxis('y2',label='ID',independentTicks=T)%>%
            dySeries('ID',axis='y2')%>%
            dyRangeSelector() %>%
            #dyHighlight(highlightCircleSize = 4, 
            #        highlightSeriesBackgroundAlpha = 0.2,
            #       hideOnMouseOut = TRUE)%>%
            dyOptions(drawPoints = FALSE, pointSize = 2)%>%
            dyLegend(show = "always")
}

dyStageAdjonly(df=stage_adj)
```

###### 4) Check manual measurements

stream measurements performed from caprod post

```{r importmanualfc1_lw2_22}
# load manual measurements
interfiles <- 'formatted_data/manual_measurements/2022/manual_wells_waterlevel_meas.csv'
file_path <- paste(getwd(),interfiles, sep='/')

manMeas <- read.table(file_path, skip=0, header=TRUE, sep=",", row.names = NULL, as.is = TRUE)

manMeas<- read.csv(file_path) %>%
      #timezone set to MST, change if loggers used MDT/MST
  mutate(datetime = round_date(mdy_hm(datetime, tz='America/Phoenix'),'30 minutes')) %>% 
  mutate(water_depth = dep_to_bed-dep_to_water) %>% 
  filter(., site == 'fc1' & position == 'lw2' )
  
cols <- c('watershed', 'site', 'position', 'tech')
manMeas[cols] <- lapply(manMeas[cols], factor) 
```


```{r depthoffsetfc1_lw2_22}
#choose a static depth to bed value. Here we are using a mean of manual bed measurements from the top of the caprod post
stat_to_bed <- manMeas%>%
  summarize(mean_dep_to_bed = mean(dep_to_bed,na.rm=T))%>%
  pull(mean_dep_to_bed)

manMeas_fil <- manMeas %>%
      dplyr::rename(., wtr_depth_not_static = water_depth) %>%
      mutate(man_wtr_dep_static = stat_to_bed - dep_to_water)
### 10 to convert mm to cm

depth_offset <- manMeas_fil %>%
  slice_min(datetime) %>%
  left_join(stage_adj %>%
              dplyr::select(datetime, adj_stage)) %>%
  mutate(depth_offset = man_wtr_dep_static - adj_stage)%>%
  pull(depth_offset)
```

Manual adjustments: 

```{r plot6fc1_lw2_22,, fig.align = "center", fig.cap = "Figure4.2202.FC1.lw2: Adjusted pressure data from Fool 1 stream channel which includes a manual offset that adjusts all values in the dataframe."}
#start with 0 value, change if plots below suggest need for manual adjustment change value. 
manual_offset <- 0

stage_adj <- stage_adj%>%
  mutate(wtr_depth = adj_stage + depth_offset + manual_offset)

```

##### Compare cleaned water level to manual measurements

```{r plot7fc1_lw2_22, fig.align = "center"}
#plot difference between measured water depth and manual depth measurement
stage_adj <- as.data.frame(stage_adj)
stageAdj.man<- dplyr::left_join(manMeas_fil, stage_adj, by = 'datetime') %>%
      mutate(diff = man_wtr_dep_static-wtr_depth)

ggplot(stageAdj.man, aes(datetime, diff))+
  geom_point(size=3)+
  theme_minimal()
```

##### Plot adjusted stage

```{r plot8fc1_lw2_22, fig.align = "center", fig.cap = "Figure 2.1.7: Adjusted stage data with manual measurements (points)"}
#plot water level time series with manual measurements as points
stage_check_plot<- stage_adj%>%
  dplyr::left_join(.,manMeas_fil, by = 'datetime') %>%
  ggplot(aes(datetime,wtr_depth))+
    geom_line()+
    geom_point(aes(datetime, man_wtr_dep_static),size=3,col='red')

ggplotly(stage_check_plot)
```

##### Export cleaned data

```{r savefc1_lw2_22}
stage_final <- stage_adj %>%
      drop_na() %>%
      mutate(date = lubridate::date(datetime)) %>%
      mutate(time = format(datetime, format = "%H:%M")) %>%
      dplyr::select(watershed, site, date, time, wtr_depth, level_flag) 
    
loc_site<- paste(watershed,site, sep='_') 

interfiles <- 'clean_data/stage_pressure'
file_path <- paste(getwd(), interfiles,year,watershed,site, sep='/')
#saveRDS(stage_final, file=paste0('data/cln/wtr_lvl_',loc_site,'.csv'))
write_csv(stage_final, file=paste0(file_path, '/',site, '_clean.csv'))

```

```{r}
# Simple df of adjusted values for stacked plot (see below)
simplefc1lw2_22 <- stage_adj %>%
  select(datetime, wtr_depth, site) %>%
  drop_na()
```

#### RW1 {.tabset .tabset-fade .tabset-pills}

```{r formatrw1_fc1_22}
mrg_press_adj <- as.data.frame(press_adj[,c('datetime','adj_press')])
  
stage_well <- merge(press_raw_rw1, mrg_press_adj, by = 'datetime') %>%
  mutate(adj_h2opressure = pressure_kPa - adj_press) %>%
  mutate(hobo_wtr_depth_cm = ((100*(adj_h2opressure*7.0)/145)) + 1.6) # kPa range 0-145, range at 10,000ft 0 to 7m plus 1.6cm for logger sensor height

```

##### Create complete timeseries to identify any missing datetimes from the dataframe
```{r checktimefc1_rw1_22, echo=FALSE, results = 'asis'}
#check if collection interval is consistent in dataset. Function as written only handles one interval but can be modified if interval was changed. 

ts_interval<- stage_well$datetime[2] - stage_well$datetime[1]

##round datetime to nearest whole interval
stage_well <- stage_well%>%
  mutate(datetime = round_date(datetime, as.period(ts_interval)))

#create full timeseries 
full_ts <- tibble(datetime=seq.POSIXt(stage_well$datetime[1], stage_well$datetime[length(stage_well$datetime)], by=ts_interval))
stage_well <- full_join(full_ts, stage_well, by='datetime')

#identify missing timesteps:
miss_ts <- filter(stage_well, is.na(pressure_kPa)) %>%
  pull(datetime)
```


```{r checktime2fc1_rw1_22, echo=FALSE, results = 'asis'}
cat(paste0(
  "- `", 'The number of missing timesteps is ', length(miss_ts), "`", sep = "\n"))

```

##### Plot Raw Pressure

1) Plot temperature for quick checks
 
```{r chktempfc1_rw1_22, fig.align = "center", fig.cap = "Figure1.2202.FC1.rw1: Air temperature data captured by the HOBO water level logger monitoring stream pressure in Fool 1 - 2021.", echo=FALSE}

#check temp data
DyTemp(df = stage_well, airtemp = 'n') #check function if have logger_temp, default is 'y'

#  rw1 (46979:49719, 55439:55479, 64919:64954, 69914:69949, 80104:80159, 85604:85619, 90689:90729, 90799:90834, 95014:95063)
```

2) Plot raw pressure data with flag if raw level changes by more than 2%.
```{r plantflagsfc1_rw1_22a, fig.align = "center", fig.cap = "Figure2.2202.FC1.rw1: Raw pressure data from Fool 1 stream 2021 with 'flags' where average pressure changes by more than 20% in a single timestep", echo=FALSE}

#Raw pressure plot
DyRawPress(df=stage_well,threshold = 0.05, flag='TRUE')
```

##### Clean raw stage

1) Plot raw water depth data with flag if raw level changes by more than 2%.
```{r plantflagsfc1_rw1_22b, fig.align = "center", fig.cap = "Figure2.2202.FC1.rw1: Raw stage data from Fool 1 stream 2021 with 'flags' where average stage changes by more than 20% in a single timestep", echo=FALSE}

#Raw stage plot
DyRawStage(df=stage_well, threshold = 0.2, flag='TRUE', max = 100)
```

2) Manually identify points to be removed or corrected using the flagged plot
```{r badidfc1_rw1_22}

bad_id_fc1_well22 <-  c(46979:49719, 55439:55479, 64919:64954, 69914:69949, 80104:80159, 85604:85619, 90689:90729, 90799:90834, 95014:95063)

vert_correction_fc1_well22<- data.frame(ID = c(0:1), offset=c(0))%>%
  mutate(cumOffset = cumsum(offset))
```


```{r badid2fc1_rw1_22, include=FALSE}  
bad_id <- bad_id_fc1_well22
vert_correction <- vert_correction_fc1_well22

#bad_id <- 0
```

3) Vertical adjustments
```{r vertcorrectfc1_rw1_22}

#function to make vertical correction and interpolate between missing values 
stage_adj<- AdjStage(df=stage_well, maxgap=8) %>%
    mutate(watershed = watershed) %>%
    mutate(site = site) %>%
    filter(ID > 3) %>% # beginning of data
    mutate(level_flag = ifelse(pressure_kPa < 0, 'Below Logger',
    ifelse(pressure_kPa > 145, 'Over Logger', 'In Range')))

#stageAdj<- AdjStage(maxgap=30)

```

Plot adjusted stage
```{r plot4fc1_rw1_22, fig.align = "center", fig.cap = "Figure3.2202.FC1.rw1: Pressure data from Fool 1 stream after the first round of adjustments, which include eliminating points where HOBO was out of the stream for periodic downloading and eliminating points collected after HOBO was removed from the stream. Both raw and adjusted values are shown", echo=FALSE}

dyStageAdj(df=stage_adj, max = 80)

```

Plot adjusted values only:
```{r plot5fc1_rw1_22, fig.align = "center", fig.cap = "Figure 3.1.5: Same as 3.1.4 but limited to adjusted values only.", echo=FALSE}
dyStageAdjonly<- function(df, max=60){
      tsStageAdj<- xts(dplyr::select(df, datetime, adj_stage, ID), order.by=df$datetime)
      dygraph(tsStageAdj, main = site) %>% 
            dyAxis('y',label='cm',valueRange = c(30, max))%>%
            dyAxis('y2',label='ID',independentTicks=T)%>%
            dySeries('ID',axis='y2')%>%
            dyRangeSelector() %>%
            #dyHighlight(highlightCircleSize = 4, 
            #        highlightSeriesBackgroundAlpha = 0.2,
            #       hideOnMouseOut = TRUE)%>%
            dyOptions(drawPoints = FALSE, pointSize = 2)%>%
            dyLegend(show = "always")
}

dyStageAdjonly(df=stage_adj)
```

4) Check manual measurements - stream measurements performed from caprod post
```{r importmanualfc1_rw1_22}
# load manual measurements
interfiles <- 'formatted_data/manual_measurements/2022/manual_wells_waterlevel_meas.csv'
file_path <- paste(getwd(),interfiles, sep='/')

manMeas <- read.table(file_path, skip=0, header=TRUE, sep=",", row.names = NULL, as.is = TRUE)

manMeas<- read.csv(file_path) %>%
      #timezone set to MST, change if loggers used MDT/MST
  mutate(datetime = round_date(mdy_hm(datetime, tz='America/Phoenix'),'30 minutes')) %>% 
  mutate(water_depth = dep_to_bed-dep_to_water) %>% 
  filter(., site == 'fc1' & position == 'rw1' )
  
cols <- c('watershed', 'site', 'position', 'tech')
manMeas[cols] <- lapply(manMeas[cols], factor) 
```


```{r depthoffsetfc1_rw1_22}
#choose a static depth to bed value. Here we are using a mean of manual bed measurements from the top of the caprod post
stat_to_bed <- manMeas%>%
  summarize(mean_dep_to_bed = mean(dep_to_bed,na.rm=T))%>%
  pull(mean_dep_to_bed)

manMeas_fil <- manMeas %>%
      dplyr::rename(., wtr_depth_not_static = water_depth) %>%
      mutate(man_wtr_dep_static = stat_to_bed - dep_to_water)
### 10 to convert mm to cm

depth_offset <- manMeas_fil %>%
  slice_min(datetime) %>%
  left_join(stage_adj %>%
              dplyr::select(datetime, adj_stage)) %>%
  mutate(depth_offset = man_wtr_dep_static - adj_stage)%>%
  pull(depth_offset)
```

Manual adjustments: 
```{r plot6fc1_rw1_22,, fig.align = "center", fig.cap = "Figure4.2202.FC1.rw1: Adjusted pressure data from Fool 1 stream channel which includes a manual offset that adjusts all values in the dataframe."}
#start with 0 value, change if plots below suggest need for manual adjustment change value. 
manual_offset <- 0

stage_adj <- stage_adj%>%
  mutate(wtr_depth = adj_stage + depth_offset + manual_offset)

```

##### Compare cleaned water level to manual measurements
```{r plot7fc1_rw1_22, fig.align = "center"}
#plot difference between measured water depth and manual depth measurement
stage_adj <- as.data.frame(stage_adj)
stageAdj.man<- dplyr::left_join(manMeas_fil, stage_adj, by = 'datetime') %>%
      mutate(diff = man_wtr_dep_static-wtr_depth)

ggplot(stageAdj.man, aes(datetime, diff))+
  geom_point(size=3)+
  theme_minimal()
```


```{r plot8fc1_rw1_22, fig.align = "center", fig.cap = "Figure 2.1.7: Adjusted stage data with manual measurements (points)"}
#plot water level time series with manual measurements as points
stage_check_plot<- stage_adj%>%
  dplyr::left_join(.,manMeas_fil, by = 'datetime') %>%
  ggplot(aes(datetime,wtr_depth))+
    geom_line()+
    geom_point(aes(datetime, man_wtr_dep_static),size=3,col='red')

ggplotly(stage_check_plot)
```

##### Export cleaned data

```{r savefc1_rw1_22}
stage_final <- stage_adj %>%
      drop_na() %>%
      mutate(date = lubridate::date(datetime)) %>%
      mutate(time = format(datetime, format = "%H:%M")) %>%
      dplyr::select(watershed, site, date, time, wtr_depth, level_flag) 
    
loc_site<- paste(watershed,site, sep='_') 

interfiles <- 'clean_data/stage_pressure'
file_path <- paste(getwd(), interfiles,year,watershed,site, sep='/')
#saveRDS(stage_final, file=paste0('data/cln/wtr_lvl_',loc_site,'.csv'))
write_csv(stage_final, file=paste0(file_path, '/',site, '_clean.csv'))

```

```{r}
# Simple df of adjusted values for stacked plot (see below)
simplefc1rw1_22 <- stage_adj %>%
  select(datetime, wtr_depth, site) %>%
  drop_na()
```

#### RW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

### Fool2 {.tabset .tabset-fade}

```{r}
#some text here
```

#### Atmospheric {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### Stream {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### LW1 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### LW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### RW1 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### RW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

## 2021 {.tabset .tabset-fade}

### Fool1 {.tabset .tabset-fade}

```{r importfc1_21, include=FALSE}
interfiles <- 'formatted_data/stage_pressure'
year <- 2022
watershed<- 'fool'
site <- 'fc1'

press_raw <- concat_2022(opn_as_dflist(interfiles, year, watershed, site))
```

Quick raw plot of point data

```{r plot1fc1_21, fig.align = "center", fig.cap = 'Figure 1.2021.FC1.all: Raw data for all HOBO water level loggers in the Fool 1 transect - 2021.', echo=FALSE}
#quick plot of stage
#stage_raw[stage_raw$trans_loc == 'atms',]

ggplot(press_raw, aes(datetime, pressure_kPa, color = trans_loc))+
  geom_line() + 
  ggtitle(paste(watershed, year, sep = ' '))

```

Subset based on logger location within the transect

```{r dfsplit_fc1_21}
press_raw_list <- split(press_raw, press_raw$trans_loc)

# Write out single data frames
for (i in seq(press_raw_list))
  assign(paste0('press_raw_', press_raw_list[[i]]$trans_loc[i]), press_raw_list[[i]])
```

#### Atmospheric {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### Stream {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### LW1 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### LW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### RW1 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### RW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

### Fool2 {.tabset .tabset-fade}

```{r}
#some text here
```

#### Atmospheric {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### Stream {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### LW1 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### LW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### RW1 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```

#### RW2 {.tabset .tabset-fade .tabset-pills}

```{r}
#some text here
```
